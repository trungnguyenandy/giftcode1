<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TikTok Account Manager</title>
    <style>
        :root {
            --primary: #FE2C55;
            --secondary: #25F4EE;
            --dark: #161823;
            --light: #FFFFFF;
            --gray: #F1F1F2;
            --success: #06C755;
            --warning: #FEA511;
            --danger: #FF3B30;
            --header-height: 60px;
            --border-radius: 12px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background-color: #FAFAFA;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        /* Header */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--light);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 10px 15px;
        }
        
        .header-title {
            font-size: 1.3rem;
            color: var(--primary);
            font-weight: 600;
            text-align: center;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .stat-box {
            background-color: var(--gray);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 12px;
        }
        
        .stat-value {
            font-weight: 600;
            margin-top: 3px;
        }
        
        /* Main Content */
        .content-container {
            padding: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Card Styles */
        .card {
            background-color: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        
        .card-title {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Form Elements */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #DDD;
            border-radius: var(--border-radius);
            font-size: 15px;
            background-color: var(--light);
            transition: border 0.2s;
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Buttons */
        .btn {
            padding: 12px 15px;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-primary {
            background-color: var(--primary);
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: var(--dark);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        /* Account Display */
        .account-info {
            margin-bottom: 20px;
        }
        
        .account-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #EEE;
        }
        
        .account-field:last-child {
            border-bottom: none;
        }
        
        .account-label {
            font-weight: 500;
            color: #555;
            min-width: 100px;
        }
        
        .account-value {
            font-weight: 600;
            text-align: right;
            max-width: 60%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .copy-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            padding: 5px;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading-spinner {
            border: 3px solid rgba(254, 44, 85, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--dark);
            color: white;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .stats-container {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .account-field {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .account-value {
                text-align: left;
                max-width: 100%;
                width: 100%;
            }
            
            .copy-btn {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="app-header">
        <div class="header-title">
            <span>üì±</span> TikTok Account Manager
        </div>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-label">T√†i kho·∫£n kh·∫£ d·ª•ng</div>
                <div class="stat-value" id="availableCount">--</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">T√†i kho·∫£n ƒë√£ d√πng</div>
                <div class="stat-value" id="usedCount">--</div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="content-container">
        <div class="card">
            <h3 class="card-title">üîç T√¨m t√†i kho·∫£n</h3>
            
            <div class="input-group">
                <label class="input-label" for="accountIdInput">Nh·∫≠p s·ªë th·ª© t·ª± (STT)</label>
                <input type="number" id="accountIdInput" placeholder="Nh·∫≠p STT t√†i kho·∫£n...">
            </div>
            
            <div class="btn-group">
                <button id="searchByIdBtn" class="btn btn-primary">
                    <span>üîé</span> Xem theo STT
                </button>
                <button id="getRandomBtn" class="btn btn-secondary">
                    <span>üé≤</span> Xem ng·∫´u nhi√™n
                </button>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p>ƒêang t·∫£i t√†i kho·∫£n...</p>
            </div>
        </div>
        
        <div class="card" id="accountCard" style="display: none;">
            <h3 class="card-title">üìã Th√¥ng tin t√†i kho·∫£n</h3>
            
            <div class="account-info">
                <div class="account-field">
                    <span class="account-label">STT:</span>
                    <span class="account-value" id="sttDisplay"></span>
                </div>
                <div class="account-field">
                    <span class="account-label">T√†i kho·∫£n:</span>
                    <div style="display: flex; align-items: center;">
                        <span class="account-value" id="accountDisplay"></span>
                        <button class="copy-btn" data-target="accountDisplay">‚éò</button>
                    </div>
                </div>
                <div class="account-field">
                    <span class="account-label">M·∫≠t kh·∫©u:</span>
                    <div style="display: flex; align-items: center;">
                        <span class="account-value" id="passwordDisplay"></span>
                        <button class="copy-btn" data-target="passwordDisplay">‚éò</button>
                    </div>
                </div>
                <div class="account-field">
                    <span class="account-label">Email:</span>
                    <div style="display: flex; align-items: center;">
                        <span class="account-value" id="emailDisplay"></span>
                        <button class="copy-btn" data-target="emailDisplay">‚éò</button>
                    </div>
                </div>
                <div class="account-field">
                    <span class="account-label">OAuth2:</span>
                    <div style="display: flex; align-items: center;">
                        <span class="account-value" id="oauthDisplay"></span>
                        <button class="copy-btn" data-target="oauthDisplay">‚éò</button>
                    </div>
                </div>
                <div class="account-field">
                    <span class="account-label">Tr·∫°ng th√°i:</span>
                    <span class="account-value" id="statusDisplay">Ch∆∞a s·ª≠ d·ª•ng</span>
                </div>
            </div>
            
            <div class="btn-group">
                <button id="copyAllBtn" class="btn btn-success">
                    <span>‚éò</span> Copy t·∫•t c·∫£
                </button>
                <button id="markUsedBtn" class="btn btn-danger">
                    <span>‚úì</span> ƒê√°nh d·∫•u ƒë√£ d√πng
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // App Configuration
        const config = {
            apiUrl: 'https://script.google.com/macros/s/AKfycbz0QaWU57qAN7Tkoi0qQ8FdwU3vBWZF814YDjZG_YQ_Tfc6v_AM66LOok7FYU4m6Yh4jQ/exec',
            isIOS: /iPhone|iPad|iPod/i.test(navigator.userAgent)
        };
        
        // App State
        const state = {
            currentAccount: null,
            isProcessing: false,
            stats: {
                available: 0,
                used: 0
            }
        };
        
        // DOM Elements
        const elements = {
            // Stats
            availableCount: document.getElementById('availableCount'),
            usedCount: document.getElementById('usedCount'),
            
            // Search
            accountIdInput: document.getElementById('accountIdInput'),
            searchByIdBtn: document.getElementById('searchByIdBtn'),
            getRandomBtn: document.getElementById('getRandomBtn'),
            
            // Account Display
            accountCard: document.getElementById('accountCard'),
            sttDisplay: document.getElementById('sttDisplay'),
            accountDisplay: document.getElementById('accountDisplay'),
            passwordDisplay: document.getElementById('passwordDisplay'),
            emailDisplay: document.getElementById('emailDisplay'),
            oauthDisplay: document.getElementById('oauthDisplay'),
            statusDisplay: document.getElementById('statusDisplay'),
            copyAllBtn: document.getElementById('copyAllBtn'),
            markUsedBtn: document.getElementById('markUsedBtn'),
            
            // Loading
            loadingIndicator: document.getElementById('loadingIndicator'),
            
            // Notification
            notification: document.getElementById('notification')
        };
        
        // Initialize the app
        function init() {
            setupEventListeners();
            loadStats();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Search buttons
            elements.searchByIdBtn.addEventListener('click', handleSearchById);
            elements.getRandomBtn.addEventListener('click', handleGetRandom);
            
            // Account actions
            elements.copyAllBtn.addEventListener('click', handleCopyAll);
            elements.markUsedBtn.addEventListener('click', handleMarkAsUsed);
            
            // Copy buttons
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const targetId = e.target.getAttribute('data-target');
                    copyToClipboard(targetId);
                });
            });
            
            // Handle Enter key in input
            elements.accountIdInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearchById();
                }
            });
        }
        
        // ========== STATS FUNCTIONS ==========
        async function loadStats() {
            try {
                const stats = await fetchStats();
                state.stats = stats;
                updateStatsDisplay();
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        async function fetchStats() {
            const url = `${config.apiUrl}?action=getStats&_=${Date.now()}`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.status === 'success') {
                return {
                    available: parseInt(data.available) || 0,
                    used: parseInt(data.used) || 0
                };
            }
            
            throw new Error(data.message || 'Failed to load stats');
        }
        
        function updateStatsDisplay() {
            elements.availableCount.textContent = state.stats.available;
            elements.usedCount.textContent = state.stats.used;
        }
        
        // ========== ACCOUNT SEARCH FUNCTIONS ==========
        async function handleSearchById() {
            if (state.isProcessing) return;
            
            const accountId = elements.accountIdInput.value.trim();
            
            if (!accountId) {
                showNotification('Vui l√≤ng nh·∫≠p STT t√†i kho·∫£n');
                return;
            }
            
            state.isProcessing = true;
            clearAccountDisplay();
            toggleLoading(true);
            disableButton(elements.searchByIdBtn, true);
            
            try {
                const account = await fetchAccount('id', accountId);
                displayAccount(account);
                showNotification(`ƒê√£ t√¨m th·∫•y t√†i kho·∫£n STT ${accountId}`);
            } catch (error) {
                console.error('Search error:', error);
                showNotification(error.message || 'Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n');
            } finally {
                toggleLoading(false);
                disableButton(elements.searchByIdBtn, false);
                state.isProcessing = false;
            }
        }
        
        async function handleGetRandom() {
            if (state.isProcessing) return;
            
            state.isProcessing = true;
            clearAccountDisplay();
            toggleLoading(true);
            disableButton(elements.getRandomBtn, true);
            
            try {
                const account = await fetchAccount('random');
                displayAccount(account);
                showNotification('ƒê√£ l·∫•y t√†i kho·∫£n ng·∫´u nhi√™n');
            } catch (error) {
                console.error('Random error:', error);
                showNotification(error.message || 'Kh√¥ng l·∫•y ƒë∆∞·ª£c t√†i kho·∫£n');
            } finally {
                toggleLoading(false);
                disableButton(elements.getRandomBtn, false);
                state.isProcessing = false;
            }
        }
        
        async function fetchAccount(type, value = '') {
            const url = `${config.apiUrl}?action=getAccount&type=${type}&value=${encodeURIComponent(value)}&_=${Date.now()}`;
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.status === 'success' && data.account) {
                return data.account;
            }
            
            throw new Error(data.message || 'Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n');
        }
        
        function displayAccount(account) {
            state.currentAccount = account;
            
            elements.sttDisplay.textContent = account.STT || 'N/A';
            elements.accountDisplay.textContent = account.Account || 'N/A';
            elements.passwordDisplay.textContent = account.Password || 'N/A';
            elements.emailDisplay.textContent = account.Email || 'N/A';
            elements.oauthDisplay.textContent = account.OAuth2 || 'N/A';
            elements.statusDisplay.textContent = account.Status || 'Ch∆∞a s·ª≠ d·ª•ng';
            
            // Show account card
            elements.accountCard.style.display = 'block';
        }
        
        function clearAccountDisplay() {
            elements.accountCard.style.display = 'none';
            state.currentAccount = null;
        }
        
        // ========== ACCOUNT ACTIONS ==========
        async function handleCopyAll() {
            if (!state.currentAccount) return;
            
            try {
                const account = state.currentAccount;
                const text = `T√†i kho·∫£n TikTok\n\nSTT: ${account.STT}\nT√†i kho·∫£n: ${account.Account}\nM·∫≠t kh·∫©u: ${account.Password}\nEmail: ${account.Email}\nOAuth2: ${account.OAuth2}`;
                
                await navigator.clipboard.writeText(text);
                showNotification('ƒê√£ sao ch√©p to√†n b·ªô th√¥ng tin');
            } catch (error) {
                console.error('Copy error:', error);
                showNotification('L·ªói khi sao ch√©p th√¥ng tin');
            }
        }
        
        async function handleMarkAsUsed() {
            if (!state.currentAccount || state.isProcessing) return;
            
            state.isProcessing = true;
            disableButton(elements.markUsedBtn, true);
            
            try {
                const accountId = state.currentAccount.STT;
                const response = await updateAccountStatus(accountId, 'Used');
                
                if (response.status === 'success') {
                    // Update local state
                    state.currentAccount.Status = 'Used';
                    state.stats.available--;
                    state.stats.used++;
                    
                    // Update UI
                    elements.statusDisplay.textContent = 'ƒê√£ s·ª≠ d·ª•ng';
                    updateStatsDisplay();
                    showNotification('ƒê√£ ƒë√°nh d·∫•u t√†i kho·∫£n ƒë√£ s·ª≠ d·ª•ng');
                } else {
                    throw new Error(response.message || 'L·ªói khi c·∫≠p nh·∫≠t');
                }
            } catch (error) {
                console.error('Mark as used error:', error);
                showNotification(error.message || 'L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i');
            } finally {
                disableButton(elements.markUsedBtn, false);
                state.isProcessing = false;
            }
        }
        
        async function updateAccountStatus(accountId, status) {
            const url = `${config.apiUrl}?action=updateStatus&id=${encodeURIComponent(accountId)}&status=${status}&_=${Date.now()}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: accountId, status })
            });
            
            return await response.json();
        }
        
        // ========== HELPER FUNCTIONS ==========
        async function copyToClipboard(elementId) {
            try {
                const text = document.getElementById(elementId).textContent;
                await navigator.clipboard.writeText(text);
                showNotification('ƒê√£ sao ch√©p v√†o clipboard');
            } catch (error) {
                console.error('Copy error:', error);
                showNotification('L·ªói khi sao ch√©p');
            }
        }
        
        function showNotification(message, duration = 3000) {
            elements.notification.textContent = message;
            elements.notification.style.display = 'block';
            
            setTimeout(() => {
                elements.notification.style.display = 'none';
            }, duration);
        }
        
        function toggleLoading(show) {
            elements.loadingIndicator.style.display = show ? 'block' : 'none';
        }
        
        function disableButton(button, disable) {
            button.disabled = disable;
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
